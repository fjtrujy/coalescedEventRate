<html>
    <body scroll="no" style="overflow: hidden">
        <div id="canvas" style="width:512px; height:200px; background-color: brown;">
        </div>
        <div id="touchReportRate"></div>
        <div id="screenRefreshRate"></div>
    </body>
  <script>
    var diffs = [];
    var t = [];

    const touchReportRate = document.getElementById("touchReportRate");
    const screenRefreshRate = document.getElementById("screenRefreshRate");
    const canvas = document.getElementById("canvas");
    
    function average(nums) {
        return nums.reduce((a, b) => (a + b)) / nums.length;
    }

    function printResults() {
        touchReportRate.innerHTML = "Average Touch Report Rate: " + average(diffs);
    }

    function clear() {
        diffs = [];
        touchReportRate.innerHTML = "<br>";
    }

    function move() {
        const coalesced = event.getCoalescedEvents();
        const timeStamps = coalesced.map((x, _) => x.timeStamp);
        if (timeStamps.length >= 2) {
            var diffTimestamps =  timeStamps.map((x, i) => x - timeStamps[i-1]);
            diffTimestamps.shift();
            
            diffs.push.apply(diffs, diffTimestamps);
        }

        if (diffs.length > 0) {
            printResults();
        }
    }

    function pointermove(event) {
        event.preventDefault();
        move();
    }

    function touchmove(event) {
        event.preventDefault();
        move();
    }

    function pointerup(event) {
        event.preventDefault();
        clear();
    }

    function pointerleave(event) {
        event.preventDefault();
        clear();
    }

    if (!window.requestAnimationFrame) {
        window.requestAnimationFrame =
            window.mozRequestAnimationFrame ||
            window.webkitRequestAnimationFrame;
    }

    function animate(now) {
        
        t.unshift(now);
        if (t.length > 10) {
            var t0 = t.pop();
            var fps = Math.floor(1000 * 10 / (now - t0));
            screenRefreshRate.innerHTML = 'Screen refresh rate: ' + fps + ' fps';
        }

        window.requestAnimationFrame(animate);
    };

    window.requestAnimationFrame(animate);

    
    clear();
    canvas.addEventListener("pointermove", pointermove, false);
    canvas.addEventListener("touchmove", touchmove, false);
    canvas.addEventListener("pointerup", pointerup, false);
    canvas.addEventListener("pointerleave", pointerleave, false);

  </script>
</html>
